Bonjour,

Voici les instructions pour réparer votre tableau de bord administrateur.
Cela prend moins de 5 minutes.

---------------------------------------------------------------------
### Instructions pour réparer le tableau de bord
---------------------------------------------------------------------

1.  **Connectez-vous à votre compte Supabase :**
    Allez sur [https://supabase.com/](https://supabase.com/) et connectez-vous.

2.  **Ouvrez votre projet :**
    Sélectionnez votre projet nommé `zkbnvzyjookcvzwvodik`.

3.  **Allez à l'éditeur SQL :**
    Dans le menu de gauche, cliquez sur l'icône qui ressemble à une base de données avec "SQL Editor".

4.  **Créez une nouvelle requête :**
    Cliquez sur le bouton "+ New query" en haut à gauche.

5.  **Copiez et collez le code :**
    Copiez TOUT le code SQL ci-dessous et collez-le dans la fenêtre de l'éditeur SQL.

6.  **Exécutez le code :**
    Cliquez sur le bouton vert "RUN" en bas à droite.

Une fois que vous aurez exécuté ce code, les fonctions manquantes seront créées et votre tableau de bord devrait fonctionner immédiatement.

---------------------------------------------------------------------
### Code SQL à copier
---------------------------------------------------------------------

-- /sql/db_functions.sql
-- This file contains the necessary SQL functions for the admin dashboard.
-- Please apply this file to your Supabase database.

-- Function to get sales by month
CREATE OR REPLACE FUNCTION get_sales_by_month()
RETURNS TABLE(month TEXT, total_sales NUMERIC) AS $$
BEGIN
    RETURN QUERY
    SELECT
        to_char(date_trunc('month', date_creation), 'YYYY-MM') AS month,
        SUM(montant_total) AS total_sales
    FROM commandes
    WHERE statut_paiement IN ('PAYE_EN_LIGNE', 'PAYE_PRESENTIEL')
    GROUP BY date_trunc('month', date_creation)
    ORDER BY date_trunc('month', date_creation);
END;
$$ LANGUAGE plpgsql;

-- Function to get payment method distribution
CREATE OR REPLACE FUNCTION get_payment_method_distribution()
RETURNS TABLE(methode_paiement TEXT, count BIGINT) AS $$
BEGIN
    RETURN QUERY
    SELECT
        methode_paiement,
        COUNT(*) AS count
    FROM commandes
    GROUP BY methode_paiement;
END;
$$ LANGUAGE plpgsql;

-- Function to get order status distribution
CREATE OR REPLACE FUNCTION get_order_status_distribution()
RETURNS TABLE(statut_paiement TEXT, count BIGINT) AS $$
BEGIN
    RETURN QUERY
    SELECT
        statut_paiement,
        COUNT(*) AS count
    FROM commandes
    GROUP BY statut_paiement;
END;
$$ LANGUAGE plpgsql;
